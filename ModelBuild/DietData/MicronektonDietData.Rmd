---
title: "MicronektonDietData"
output: html_document
---

# Purpose

The purpose of this script is to work with the data from Barnes et al. (2008) 
and Portner et al. (2023) to estimate *beta* and *sigma* for a possible 
micronekton species group to possibly be used in our model. 

```{r}
# Set up environment
library(tidyverse) # for working with data
library(here) # OS-agnostic file path management
library(readxl) # For reading in .xlsx data from Portner et al. 2023
```

```{r}
# Load Barnes data
# This follows the file structure of the zipped files one gets when downloading
# the Barnes data (3529112/.../...)
# The file has tab-separated values (hence read_tsv)
# Loading the data produces a warning about an NA value in row 28292 col 12
Barnes <- read_tsv(here("ModelBuild", "DietData", "3529112", "ECOL_89_51", 
                        "Predator_and_prey_body_sizes_in_marine_food_webs_vsn4.txt"),
                   show_col_types = FALSE)

```

```{r}
# Wrangle Barnes data in the same was as we do for other species/groups
# Let's restrict ourselves to "ectotherm vertebrates" 
BarnesEV <- Barnes |>
  filter(`Predator  taxon` == "ectotherm vertebrate")
# This omits "cephalopod" records

# And we can omit some geographic regions right off the top
BarnesEV_notHighLat <- BarnesEV |>
  filter(`Geographic location` != "Gulf of Alaska" &
         `Geographic location` != "NE North Sea and Skaggerak" &
         `Geographic location` != "W Greenland" &
          `Geographic location` != "Strait of Georgia" &
          `Geographic location` != "Antarctic Peninsula" &
          `Geographic location` != "Greenland")
# This retains the following regions:
# "Apalachicola Bay, Florida", "Crooked Island Sound, Florida",
# "Jeffreys Ledge, Gulf of Maine, New England", "Stellwagen Bank, Gulf of Maine, New England",
# "Cape Cod Bay, Gulf of Maine, New England", "Great Channel South, Gulf of Maine, New England",
# "South of Marthas Vineyard, New England", "Gulf of Maine, New England",
# "Andaman Sea (West of South Thailand)", "French Polynesian EEZ", "Catalan Sea",
# "Western North Pacific", "Atlantic Ocean", "Off the Bay of Biscay",
# "Great South Bay, Long Island, New York", "Europe, Celtic Sea ecosystem",                  
# "Oxwich Bay, Wales", "Eastern Mediterranean"  

# And we can eliminate some specific habitat types
BarnesEV_noHighLat_PelagicPlus <- BarnesEV_notHighLat |>
  filter(`Specific habitat` != "demersal food web" &
         `Specific habitat` != "estuary/coastal")
# This retains the following habitats
# "Coastal Bay", "Shelf", "inshore", "open ocean", "shelfbreak/open ocean",
# "transition region", "Pelagic", "Off the continental shelf", "Coastal bay",
# "Euboikos and Pagassitikos Gulfs"

# Group just the micronekton groups
Barnes_final_umnk <- BarnesEV_noHighLat_PelagicPlus |>
  filter(`Predator common name` == "Myctophidae fish larva" |
         `Predator common name` == "Paralepididae fish larva")
```

```{r}
# Load Portner data
Portner <- read_excel(here("ModelBuild", "DietData",
                           "41598_2023_41298_MOESM4_ESM.xlsx"), 
                           sheet = "individual_prey_mass")
```

```{r}
# Barnes and Portner both use the same units (g)
# Let's make a combined predator group and a combined prey group
Preds <- c(Barnes_final_umnk$`Predator mass`, Portner$predator_mass)
Preys <- c(Barnes_final_umnk$`Prey mass`, Portner$prey_mass)
```

```{r}
# Treat them the same way as other species (BarnesDietData.Rmd)
plot(log10(Preys), log10(Preds))

# We want the linear predator-prey mass ratio (PPMR).  This is beta.
plot(Preds/Preys)

# There are some outliers in the PPMR that it seems reasonable to remove.
# We'll use the median as the beta and 
# we'll take the distance across the middle 90% of the log10-transformed PPMR
# as sigma
umnk_PPMR <- Preds/Preys
umnk_PPMR_quartiles <- quantile(umnk_PPMR, probs = c(0, 0.05, 0.5, 0.95, 1))
umnk_PPMR_quartiles_log10 <- quantile(log10(umnk_PPMR), probs = c(0, 0.05, 0.5, 0.95, 1))

umnk_beta <- umnk_PPMR_quartiles[[3]]
umnk_sigma <- umnk_PPMR_quartiles_log10[[4]] - umnk_PPMR_quartiles_log10[[2]]
```


